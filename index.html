<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>花店帳單系統</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    header { display: flex; align-items: center; margin-bottom: 20px; }
    header img { height: 60px; margin-right: 10px; }
    h1 { font-size: 28px; }
    select { font-size: 16px; padding: 6px 10px; margin: 15px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 16px; }
    th, td { border: 1px solid #ccc; padding: 10px; }
    th { background: #f5f5f5; }
    td.amount { text-align: right; }
    tfoot td { font-weight: bold; background: #fafafa; }
  </style>
</head>

<body>
  <header>
    <img src="https://i.imgur.com/4lU0f1w.png" alt="Logo">
    <h1>花店帳單系統</h1>
  </header>

  <label>選擇花店：</label>
  <select id="shopSelector">
    <option value="">請選擇花店</option>
  </select>

  <table id="bill-table">
    <thead>
      <tr><th>Date</th><th>Bill $</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><td>總計</td><td class="amount" id="total">-</td></tr>
    </tfoot>
  </table>

<script>
  const sheetUrl =
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vTmjgIB2redh4NdA30SDpL3nsgrXXK-loggFKF6tASuOSgrkRnD3l93uln8V4LtRyf9cbGzaGPnTcFm/pub?gid=268664297&single=true&output=csv';

  let allRows = [];
  let header = [];

  async function loadSheet() {
    const resp = await fetch(sheetUrl);
    const text = await resp.text();
    const rows = text.trim().split("\n").map(r => r.split(","));
    header = rows.shift();
    allRows = rows;
    populateShopSelector();
  }

  function populateShopSelector() {
    const shopIndex = header.indexOf("花店名稱");
    const shopSelector = document.getElementById("shopSelector");

    const shops = [...new Set(allRows.map(row => row[shopIndex]))];

    shops.forEach(shop => {
      const option = document.createElement("option");
      option.value = shop;
      option.textContent = shop;
      shopSelector.appendChild(option);
    });

    shopSelector.addEventListener("change", () =>
      loadTable(shopSelector.value)
    );
  }

  function loadTable(targetShop) {
    const dateIndex = header.indexOf("Date");
    const billIndex = header.indexOf("Bill $");

    const tbody = document.querySelector("#bill-table tbody");
    tbody.innerHTML = "";

    let total = 0;

    allRows.forEach(row => {
      const shop = row[header.indexOf("花店名稱")];
      const date = row[dateIndex];

      const raw = row[billIndex] || "";
      const bill = Number(raw.replace(/[^0-9.-]/g, ""));

      if (shop === targetShop) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${date}</td>
          <td class="amount">${isNaN(bill) ? "" : bill.toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
        if (!isNaN(bill)) total += bill;
      }
    });

    document.getElementById("total").textContent = total.toLocaleString();
  }

  loadSheet();
</script>
</body>
</html>
